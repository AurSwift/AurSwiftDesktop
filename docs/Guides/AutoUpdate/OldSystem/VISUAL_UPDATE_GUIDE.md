# Visual Guide: What Happens During Updates

Quick visual reference for understanding database behavior in different scenarios.

---

## Scenario 1: Fresh Install (New Client) ğŸ†•

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ USER DOWNLOADS INSTALLER FROM GITHUB RELEASES               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ INSTALLER RUNS (AuraSwift-{version}-Windows-x64.exe)        â”‚
â”‚ - Extracts app files to Program Files                       â”‚
â”‚ - Creates desktop shortcut                                  â”‚
â”‚ - Creates Start Menu entry                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ USER LAUNCHES APP FOR FIRST TIME                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ DATABASE INITIALIZATION                                      â”‚
â”‚                                                              â”‚
â”‚ âœ“ Create directory:                                         â”‚
â”‚   C:\Users\{User}\AppData\Roaming\AuraSwift\                â”‚
â”‚                                                              â”‚
â”‚ âœ“ Create SQLite file:                                       â”‚
â”‚   pos_system.db                                              â”‚
â”‚                                                              â”‚
â”‚ âœ“ Create backup directory:                                  â”‚
â”‚   backups/                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ MIGRATION PROCESS                                            â”‚
â”‚                                                              â”‚
â”‚ Step 1: Integrity Check                                     â”‚
â”‚ PRAGMA integrity_check;                                      â”‚
â”‚ Result: âœ“ ok                                                â”‚
â”‚                                                              â”‚
â”‚ Step 2: Create Backup                                       â”‚
â”‚ Copy pos_system.db â†’                                         â”‚
â”‚      backups/auraswift-backup-2025-11-12T16-00-00.db        â”‚
â”‚                                                              â”‚
â”‚ Step 3: Apply ALL Migrations (from scratch)                 â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚ â”‚ 0000_initial_schema.sql                         â”‚         â”‚
â”‚ â”‚ - CREATE TABLE businesses                       â”‚         â”‚
â”‚ â”‚ - CREATE TABLE users                            â”‚         â”‚
â”‚ â”‚ - CREATE TABLE products                         â”‚         â”‚
â”‚ â”‚ - CREATE TABLE transactions                     â”‚         â”‚
â”‚ â”‚ - CREATE TABLE categories                       â”‚         â”‚
â”‚ â”‚ - ... 15+ tables                                â”‚         â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                    â†“                                         â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚ â”‚ 0001_add_discount_system.sql                    â”‚         â”‚
â”‚ â”‚ - CREATE TABLE discounts                        â”‚         â”‚
â”‚ â”‚ - ALTER TABLE transactions                      â”‚         â”‚
â”‚ â”‚ - CREATE INDEX idx_discounts                    â”‚         â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                                              â”‚
â”‚ Step 4: Record Migrations                                   â”‚
â”‚ INSERT INTO __drizzle_migrations:                            â”‚
â”‚ - 0000_initial_schema (hash: abc123...)                     â”‚
â”‚ - 0001_add_discount_system (hash: def456...)                â”‚
â”‚                                                              â”‚
â”‚ Step 5: Track Version                                       â”‚
â”‚ INSERT INTO _app_version:                                    â”‚
â”‚ - version: {current-version}                                â”‚
â”‚ - updated_at: 2025-11-12 16:00:00                           â”‚
â”‚                                                              â”‚
â”‚ Step 6: Verify Integrity                                    â”‚
â”‚ PRAGMA integrity_check;                                      â”‚
â”‚ Result: âœ“ ok                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SEED DEFAULT DATA                                            â”‚
â”‚                                                              â”‚
â”‚ Check: SELECT COUNT(*) FROM users;                           â”‚
â”‚ Result: 0 (empty)                                           â”‚
â”‚                                                              â”‚
â”‚ âœ“ Create business:                                          â”‚
â”‚   - Demo Store                                              â”‚
â”‚                                                              â”‚
â”‚ âœ“ Create users:                                             â”‚
â”‚   - admin (PIN: 1234)                                       â”‚
â”‚   - manager (PIN: 5678)                                     â”‚
â”‚   - cashier (PIN: 9999)                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ APP READY                                                    â”‚
â”‚ User sees login screen                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

DATABASE STATE:
â””â”€â”€ C:\Users\{User}\AppData\Roaming\AuraSwift\
    â”œâ”€â”€ pos_system.db â† ACTIVE DATABASE
    â”‚   â”œâ”€â”€ __drizzle_migrations (2 rows)
    â”‚   â”œâ”€â”€ _app_version (version: {current-version})
    â”‚   â”œâ”€â”€ businesses (1 row: Demo Store)
    â”‚   â”œâ”€â”€ users (3 rows: admin, manager, cashier)
    â”‚   â”œâ”€â”€ products (0 rows)
    â”‚   â”œâ”€â”€ transactions (0 rows)
    â”‚   â””â”€â”€ ... (15+ empty tables)
    â””â”€â”€ backups/
        â””â”€â”€ auraswift-backup-2025-11-12T16-00-00.db â† FIRST BACKUP
```

---

## Scenario 2: Normal Update (Previous â†’ New Version) ğŸ”„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ USER LAUNCHES APP (Previous Version)                        â”‚
â”‚ Auto-updater checks GitHub periodically                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ GITHUB RELEASES API                                          â”‚
â”‚                                                              â”‚
â”‚ Latest release: v{new-version}                              â”‚
â”‚ Current version: v{previous-version}                        â”‚
â”‚ Update available? YES                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ UPDATE NOTIFICATION                                          â”‚
â”‚                                                              â”‚
â”‚  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—                 â”‚
â”‚  â•‘ Update Available                       â•‘                 â”‚
â”‚  â•‘                                        â•‘                 â”‚
â”‚  â•‘ New version: {new-version}             â•‘                 â”‚
â”‚  â•‘ Release notes:                         â•‘                 â”‚
â”‚  â•‘ - Loyalty Program System               â•‘                 â”‚
â”‚  â•‘ - Member management                    â•‘                 â”‚
â”‚  â•‘                                        â•‘                 â”‚
â”‚  â•‘ [Download] [Remind Later] [Skip]      â•‘                 â”‚
â”‚  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                 â”‚
â”‚                                                              â”‚
â”‚ User clicks: [Download]                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ BACKGROUND DOWNLOAD                                          â”‚
â”‚                                                              â”‚
â”‚ Downloading: AuraSwift-{version}-delta.nupkg (small delta)  â”‚
â”‚ Progress: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 100% (12.5 MB)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ READY TO INSTALL                                             â”‚
â”‚                                                              â”‚
â”‚  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—                 â”‚
â”‚  â•‘ Update Ready                           â•‘                 â”‚
â”‚  â•‘                                        â•‘                 â”‚
â”‚  â•‘ AuraSwift v{new-version} is ready to install â•‘          â”‚
â”‚  â•‘                                        â•‘                 â”‚
â”‚  â•‘ App will restart to complete update    â•‘                 â”‚
â”‚  â•‘                                        â•‘                 â”‚
â”‚  â•‘ [Restart & Install] [Install Later]   â•‘                 â”‚
â”‚  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                 â”‚
â”‚                                                              â”‚
â”‚ User clicks: [Restart & Install]                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ APP CLOSES â†’ INSTALLER RUNS â†’ APP RELAUNCHES                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ DATABASE INITIALIZATION (New Version Launch)                â”‚
â”‚                                                              â”‚
â”‚ âœ“ Open existing database:                                   â”‚
â”‚   C:\Users\{User}\AppData\Roaming\AuraSwift\pos_system.db   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ VERSION CHECK                                                â”‚
â”‚                                                              â”‚
â”‚ SELECT version FROM _app_version;                            â”‚
â”‚ Stored: {previous-version}                                  â”‚
â”‚ Current: {new-version}                                      â”‚
â”‚                                                              â”‚
â”‚ âœ“ No downgrade (new > previous)                             â”‚
â”‚ âœ“ Update stored version to {new-version}                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ MIGRATION PROCESS                                            â”‚
â”‚                                                              â”‚
â”‚ Step 1: Integrity Check                                     â”‚
â”‚ PRAGMA integrity_check;                                      â”‚
â”‚ Result: âœ“ ok                                                â”‚
â”‚                                                              â”‚
â”‚ Step 2: Create NEW Backup                                   â”‚
â”‚ Copy pos_system.db â†’                                         â”‚
â”‚      backups/auraswift-backup-2025-11-12T17-30-00.db        â”‚
â”‚                                                              â”‚
â”‚ Step 3: Check Applied Migrations                            â”‚
â”‚ SELECT * FROM __drizzle_migrations;                          â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚ â”‚ Already applied:                   â”‚                      â”‚
â”‚ â”‚ âœ“ 0000_initial_schema              â”‚                      â”‚
â”‚ â”‚ âœ“ 0001_add_discount_system         â”‚                      â”‚
â”‚ â”‚                                    â”‚                      â”‚
â”‚ â”‚ Pending (NEW):                     â”‚                      â”‚
â”‚ â”‚ â—‹ 0002_add_loyalty_program         â”‚                      â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â”‚                                                              â”‚
â”‚ Step 4: Apply ONLY New Migration                            â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚ â”‚ 0002_add_loyalty_program.sql                    â”‚         â”‚
â”‚ â”‚                                                 â”‚         â”‚
â”‚ â”‚ CREATE TABLE loyalty_members (                 â”‚         â”‚
â”‚ â”‚   id TEXT PRIMARY KEY,                         â”‚         â”‚
â”‚ â”‚   business_id TEXT,                            â”‚         â”‚
â”‚ â”‚   name TEXT,                                   â”‚         â”‚
â”‚ â”‚   points INTEGER DEFAULT 0,                    â”‚         â”‚
â”‚ â”‚   ...                                          â”‚         â”‚
â”‚ â”‚ );                                             â”‚         â”‚
â”‚ â”‚                                                 â”‚         â”‚
â”‚ â”‚ CREATE TABLE loyalty_transactions (            â”‚         â”‚
â”‚ â”‚   id TEXT PRIMARY KEY,                         â”‚         â”‚
â”‚ â”‚   member_id TEXT,                              â”‚         â”‚
â”‚ â”‚   points_earned INTEGER,                       â”‚         â”‚
â”‚ â”‚   ...                                          â”‚         â”‚
â”‚ â”‚ );                                             â”‚         â”‚
â”‚ â”‚                                                 â”‚         â”‚
â”‚ â”‚ CREATE INDEX idx_loyalty_members...;           â”‚         â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                                              â”‚
â”‚ Step 5: Record New Migration                                â”‚
â”‚ INSERT INTO __drizzle_migrations:                            â”‚
â”‚ - 0002_add_loyalty_program (hash: ghi789...)                â”‚
â”‚                                                              â”‚
â”‚ Step 6: Update Version                                      â”‚
â”‚ UPDATE _app_version SET version = '{new-version}';          â”‚
â”‚                                                              â”‚
â”‚ Step 7: Verify Integrity                                    â”‚
â”‚ PRAGMA integrity_check;                                      â”‚
â”‚ Result: âœ“ ok                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CHECK SEED DATA                                              â”‚
â”‚                                                              â”‚
â”‚ SELECT COUNT(*) FROM users;                                  â”‚
â”‚ Result: 4 (admin, manager, cashier, + 1 test user)         â”‚
â”‚                                                              â”‚
â”‚ âœ“ Users exist, SKIP seeding                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ APP READY (New Version)                                      â”‚
â”‚ User sees login screen (existing account works)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

DATABASE STATE (AFTER UPDATE):
â””â”€â”€ C:\Users\{User}\AppData\Roaming\AuraSwift\
    â”œâ”€â”€ pos_system.db â† UPDATED DATABASE
    â”‚   â”œâ”€â”€ __drizzle_migrations (3 rows now) â† +1 NEW
    â”‚   â”œâ”€â”€ _app_version (version: {new-version}) â† UPDATED
    â”‚   â”œâ”€â”€ businesses (1 row) â† PRESERVED
    â”‚   â”œâ”€â”€ users (4 rows) â† PRESERVED (including test user)
    â”‚   â”œâ”€â”€ products (5 rows) â† PRESERVED (user's products)
    â”‚   â”œâ”€â”€ transactions (23 rows) â† PRESERVED (user's sales)
    â”‚   â”œâ”€â”€ {new_tables} (0 rows) â† NEW TABLES
    â”‚   â””â”€â”€ ... (other tables preserved)
    â””â”€â”€ backups/
        â”œâ”€â”€ auraswift-backup-{timestamp}.db â† Previous version backup
        â””â”€â”€ auraswift-backup-{timestamp}.db â† New version backup (NEW)

KEY POINTS:
âœ“ All existing data preserved (users, products, transactions)
âœ“ Only new migrations applied
âœ“ Version updated to new version
âœ“ New backup created
âœ“ No duplicate seeding
```

---

## Scenario 3: Skip Version (Previous â†’ Newer) â­ï¸

```
DATABASE STATE BEFORE:
â””â”€â”€ pos_system.db
    â”œâ”€â”€ _app_version: {previous-version}
    â”œâ”€â”€ __drizzle_migrations:
    â”‚   â”œâ”€â”€ 0000_initial_schema âœ“
    â”‚   â””â”€â”€ {baseline migrations} âœ“
    â””â”€â”€ (user data preserved)

                          â†“
                  USER UPDATES TO NEWER VERSION
                  (skips intermediate version)
                          â†“

MIGRATION PROCESS:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Apply ALL pending migrations in sequence:                    â”‚
â”‚                                                              â”‚
â”‚ 1. {intermediate_migration}.sql                             â”‚
â”‚    - Schema changes from intermediate version                â”‚
â”‚                                                              â”‚
â”‚ 2. {newer_migration}.sql                                    â”‚
â”‚    - Schema changes from newer version                       â”‚
â”‚                                                              â”‚
â”‚ All applied atomically in transactions                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                          â†“

DATABASE STATE AFTER:
â””â”€â”€ pos_system.db
    â”œâ”€â”€ _app_version: {newer-version} â† JUMPED
    â”œâ”€â”€ __drizzle_migrations:
    â”‚   â”œâ”€â”€ {all previous migrations} âœ“
    â”‚   â”œâ”€â”€ {intermediate_migration} âœ“ â† NEW
    â”‚   â””â”€â”€ {newer_migration} âœ“ â† NEW
    â””â”€â”€ (user data preserved + new tables)
```

---

## Scenario 4: Downgrade Blocked (Newer â†’ Older) ğŸš«

```
USER ACTION:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. Running newer version                                    â”‚
â”‚ 2. Uninstalls app (database remains in AppData)            â”‚
â”‚ 3. Downloads older version installer from GitHub            â”‚
â”‚ 4. Installs older version                                   â”‚
â”‚ 5. Launches app                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ VERSION CHECK                                                â”‚
â”‚                                                              â”‚
â”‚ SELECT version FROM _app_version;                            â”‚
â”‚ Stored in DB: {newer-version}                               â”‚
â”‚ Current app: {older-version}                                â”‚
â”‚                                                              â”‚
â”‚ âŒ DOWNGRADE DETECTED (older < newer)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ERROR DIALOG                                                 â”‚
â”‚                                                              â”‚
â”‚  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—                 â”‚
â”‚  â•‘ âŒ Cannot Open Database                â•‘                 â”‚
â”‚  â•‘                                        â•‘                 â”‚
â”‚  â•‘ This database was created with a       â•‘                 â”‚
â”‚  â•‘ newer version of AuraSwift.           â•‘                 â”‚
â”‚  â•‘                                        â•‘                 â”‚
â”‚  â•‘ Please update to the latest version   â•‘                 â”‚
â”‚  â•‘ to continue.                           â•‘                 â”‚
â”‚  â•‘                                        â•‘                 â”‚
â”‚  â•‘ Current app: {older-version}          â•‘                 â”‚
â”‚  â•‘ Database requires: {newer-version}+    â•‘                 â”‚
â”‚  â•‘                                        â•‘                 â”‚
â”‚  â•‘              [OK]                      â•‘                 â”‚
â”‚  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ APP QUITS GRACEFULLY                                         â”‚
â”‚ Database unchanged (no corruption)                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

DATABASE STATE:
â””â”€â”€ pos_system.db
    â”œâ”€â”€ _app_version: {newer-version} â† UNCHANGED
    â”œâ”€â”€ __drizzle_migrations: (all intact)
    â”œâ”€â”€ {newer_tables}: (data intact)
    â””â”€â”€ (all newer version tables intact)

SOLUTION:
User must reinstall newer version or latest
```

---

## Scenario 5: Interrupted Migration âš¡

```
MIGRATION IN PROGRESS:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Applying migration: 0002_add_loyalty_program.sql            â”‚
â”‚                                                              â”‚
â”‚ BEGIN TRANSACTION; â† Started by Drizzle                     â”‚
â”‚                                                              â”‚
â”‚ CREATE TABLE loyalty_members (...);                          â”‚
â”‚ âœ“ Completed                                                 â”‚
â”‚                                                              â”‚
â”‚ CREATE TABLE loyalty_transactions (...);                     â”‚
â”‚ âš¡ POWER LOSS / CRASH                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ AUTOMATIC ROLLBACK (by SQLite)                              â”‚
â”‚                                                              â”‚
â”‚ Transaction not committed â†’ All changes discarded            â”‚
â”‚                                                              â”‚
â”‚ ROLLBACK; â† Automatic                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ USER RESTARTS COMPUTER & LAUNCHES APP                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ MIGRATION RETRY                                              â”‚
â”‚                                                              â”‚
â”‚ Check: __drizzle_migrations                                  â”‚
â”‚ Result: 0002_add_loyalty_program NOT recorded               â”‚
â”‚                                                              â”‚
â”‚ âœ“ Retry migration from beginning                           â”‚
â”‚                                                              â”‚
â”‚ BEGIN TRANSACTION;                                           â”‚
â”‚ CREATE TABLE loyalty_members (...); âœ“                       â”‚
â”‚ CREATE TABLE loyalty_transactions (...); âœ“                  â”‚
â”‚ COMMIT; âœ“                                                   â”‚
â”‚                                                              â”‚
â”‚ âœ“ Migration completed successfully!                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

DATABASE STATE:
âœ“ No corruption
âœ“ Either:
  - Rolled back to pre-migration state, OR
  - Retry succeeded and migration completed
âœ“ Backup available for restore if needed
```

---

## Scenario 6: Corrupted Database ğŸ’¥

```
USER ACTION:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Database file corrupted (disk error, manual edit, etc.)     â”‚
â”‚ User launches app                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ INTEGRITY CHECK (before migrations)                         â”‚
â”‚                                                              â”‚
â”‚ PRAGMA integrity_check;                                      â”‚
â”‚ Result: âŒ "database disk image is malformed"               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ MIGRATIONS BLOCKED                                           â”‚
â”‚ âŒ Cannot proceed with corrupted database                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ERROR DIALOG                                                 â”‚
â”‚                                                              â”‚
â”‚  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—                 â”‚
â”‚  â•‘ âŒ Database Integrity Check Failed     â•‘                 â”‚
â”‚  â•‘                                        â•‘                 â”‚
â”‚  â•‘ The database appears to be corrupted.  â•‘                 â”‚
â”‚  â•‘                                        â•‘                 â”‚
â”‚  â•‘ Would you like to restore from the     â•‘                 â”‚
â”‚  â•‘ most recent backup?                    â•‘                 â”‚
â”‚  â•‘                                        â•‘                 â”‚
â”‚  â•‘ Backup location:                       â•‘                 â”‚
â”‚  â•‘ C:\Users\...\AuraSwift\backups\        â•‘                 â”‚
â”‚  â•‘                                        â•‘                 â”‚
â”‚  â•‘ âš ï¸  Data after backup will be lost     â•‘                 â”‚
â”‚  â•‘                                        â•‘                 â”‚
â”‚  â•‘ [Restore] [Cancel]                     â•‘                 â”‚
â”‚  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ MANUAL RESTORE PROCESS                                       â”‚
â”‚                                                              â”‚
â”‚ 1. Close app                                                â”‚
â”‚ 2. Navigate to: AppData\Roaming\AuraSwift\backups\          â”‚
â”‚ 3. Find latest: auraswift-backup-{timestamp}.db            â”‚
â”‚ 4. Copy to: AppData\Roaming\AuraSwift\                      â”‚
â”‚ 5. Rename to: pos_system.db                                â”‚
â”‚ 6. Relaunch app                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

DATABASE STATE:
âœ“ Corruption detected before any operations
âœ“ Backup available (created before corruption)
âœ“ Can restore to last known good state
```

---

## Quick Reference: File Locations

### Windows

```
Production Database:
C:\Users\{Username}\AppData\Roaming\AuraSwift\pos_system.db

Backups:
C:\Users\{Username}\AppData\Roaming\AuraSwift\backups\
â”œâ”€â”€ auraswift-backup-2025-11-12T16-00-00-000Z.db
â”œâ”€â”€ auraswift-backup-2025-11-12T17-30-00-000Z.db
â””â”€â”€ ...

Logs:
C:\Users\{Username}\AppData\Roaming\AuraSwift\logs\
```

### macOS

```
Production Database:
~/Library/Application Support/AuraSwift/pos_system.db

Backups:
~/Library/Application Support/AuraSwift/backups/

Logs:
~/Library/Logs/AuraSwift/
```

### Linux

```
Production Database:
~/.config/AuraSwift/pos_system.db

Backups:
~/.config/AuraSwift/backups/

Logs:
~/.config/AuraSwift/logs/
```

---

## Quick Reference: Database Tables

### Migration Tracking

```sql
-- Applied migrations
__drizzle_migrations (hash, timestamp, success)

-- App version tracking
_app_version (id, version, updated_at)
```

### Application Tables (Current)

```sql
businesses, users, products, categories, suppliers
transactions, transaction_items
cash_drawers, shifts, audits
discounts, inventory, schedules
time_tracking, settings
-- Plus any tables added in newer versions
```

### Migration Files

Current migrations in `packages/main/src/database/migrations/`:
- 0000_friendly_sunset_bain.sql (baseline)
- 0001_spicy_sir_ram.sql
- 0002_dual_mode_sales_support.sql
- 0002_friendly_orphan.sql
- 0003_damp_victor_mancha.sql
- 0004_slimy_trauma.sql
- 0005_loud_norman_osborn.sql
```

---

**Document Version**: 1.1  
**Last Updated**: December 30, 2025  
**Current App Version**: 1.8.0  
**See Also**: [QUICK_TESTING_CHECKLIST.md](QUICK_TESTING_CHECKLIST.md)
